## Practical 9

### Aim:
To study and implement database backup and recovery commands in MySQL. To also study and implement transaction control commands: `ROLLBACK`, `COMMIT`, and `SAVEPOINT`.

### Theory

**Database Backup:** A database backup is a copy of data that can be used to restore and recover the data after a loss. Backups are crucial for disaster recovery and protect against data loss due to hardware failure, human error, or other unforeseen events. In MySQL, the `mysqldump` utility is a common command-line tool used to create a logical backup of a database. It generates a SQL file containing the commands to recreate the database and its data.

**Database Recovery:** Database recovery is the process of restoring a database to a correct and consistent state after a failure. This is typically done using a previously created backup. The `mysql` command-line tool can be used to import the SQL file generated by `mysqldump` to restore the database.

**Transaction Control:** Transactions are a sequence of operations performed as a single logical unit of work. In the context of a database, a transaction ensures that all operations within it are completed successfully; otherwise, none of them are. This is governed by the ACID (Atomicity, Consistency, Isolation, Durability) properties. The key transaction control commands in MySQL are:

*   **COMMIT:** This command is used to save all the changes made during the current transaction, making them permanent.
*   **ROLLBACK:** This command is used to undo all the changes made in the current transaction that have not yet been committed.
*   **SAVEPOINT:** This command sets a named marker within a transaction. It allows for a partial rollback of a transaction to that specific point without affecting the entire transaction.

### Steps

#### 1. Database Backup

**Query:**

To back up a MySQL database named `your_database`, we use the `mysqldump` utility.

```console
mysqldump -u your_username -p your_database > your_database_backup.sql
```

**Output:**

A file named `your_database_backup.sql` is created in current directory. This file contains all the SQL statements necessary to recreate the `your_database` database.

#### 2. Database Recovery

**Query:**

To restore the database from the backup file, we use the `mysql` command. First, create a new database (or use an existing empty one) into which the backup will be restored.

```console
mysql -u your_username -p new_database < your_database_backup.sql
```

**Output:**

The database `new_database` now has the same structure and data as the original `your_database` from which the backup was taken.

#### 3. COMMIT, ROLLBACK, and SAVEPOINT

**Create a sample table and insert some data:**

**Query:**

```sql
CREATE DATABASE IF NOT EXISTS transaction_test;
USE transaction_test;

CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    salary INT
);

INSERT INTO employees VALUES (1, 'Priya', 50000);
INSERT INTO employees VALUES (2, 'Rohan', 60000);

SELECT * FROM employees;
```

**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 50000 |
| 2 | Rohan | 60000 |

**Implementing COMMIT and ROLLBACK:**

**Query:**

```sql
START TRANSACTION;

UPDATE employees SET salary = 65000 WHERE id = 2;
SELECT * FROM employees;
```

**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 50000 |
| 2 | Rohan | 65000 |

**Query:**
```sql
-- To make the change permanent
COMMIT;
SELECT * FROM employees;
```

**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 50000 |
| 2 | Rohan | 65000 |

Now, let's demonstrate `ROLLBACK`.

**Query:**

```sql
START TRANSACTION;

DELETE FROM employees WHERE id = 1;
SELECT * FROM employees;
```

**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 2 | Rohan | 65000 |

**Query:**
```sql
-- To undo the change
ROLLBACK;
SELECT * FROM employees;
```
**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 50000 |
| 2 | Rohan | 65000 |

**Implementing SAVEPOINT:**

**Query:**

```sql
START TRANSACTION;

INSERT INTO employees VALUES (3, 'Arjun', 70000);
SAVEPOINT my_savepoint;

UPDATE employees SET salary = 55000 WHERE id = 1;
SELECT * FROM employees;
```

**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 55000 |
| 2 | Rohan | 65000 |
| 3 | Arjun | 70000 |

**Query:**
```sql
-- Rollback to the savepoint
ROLLBACK TO my_savepoint;
SELECT * FROM employees;
```
**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 50000 |
| 2 | Rohan | 65000 |
| 3 | Arjun | 70000 |

**Query:**
```sql
-- To make the insertion of Arjun permanent
COMMIT;
SELECT * FROM employees;
```
**Output:**

**employees**
| id | name | salary |
| :-- | :--- | :--- |
| 1 | Priya | 50000 |
| 2 | Rohan | 65000 |
| 3 | Arjun | 70000 |

### Conclusion

This practical has demonstrated the essential MySQL commands for database backup and recovery using `mysqldump` and `mysql`. It also covered the fundamental transaction control commands `COMMIT`, `ROLLBACK`, and `SAVEPOINT`, which are crucial for maintaining data integrity and consistency.
